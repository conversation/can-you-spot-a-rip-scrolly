import { useRef, useState } from 'react'
import { Stage, Layer, Line } from 'react-konva'
import useSize from '@react-hook/size'
import { KonvaEventObject } from 'konva/lib/Node'
import { useAtomValue } from 'jotai'
import { quizReveal, standardSize } from '../../context/Atoms'

export default function QuizThree() {
  const parentRef = useRef(null)
  const [width, height] = useSize(parentRef)
  const [isDrawing, setIsDrawing] = useState(false)
  const [lines, setLines] = useState<{ points: number[]; stroke: string }[]>([])
  const originalSize = useAtomValue(standardSize)
  const revealAnswer = useAtomValue(quizReveal)
  const answerLines: { points: number[]; stroke: string }[] = [
    {
      points: [
        213, 539.5, 213, 539.5, 214, 539.5, 214, 539.5, 215, 539.5, 215, 540.5, 216, 540.5, 216, 540.5, 217, 540.5, 217,
        540.5, 218, 540.5, 218, 540.5, 219, 540.5, 221, 540.5, 222, 540.5, 223, 540.5, 224, 540.5, 226, 540.5, 227,
        540.5, 228, 540.5, 229, 540.5, 229, 540.5, 233, 540.5, 234, 540.5, 235, 540.5, 236, 540.5, 237, 540.5, 239,
        540.5, 240, 540.5, 241, 540.5, 242, 539.5, 243, 539.5, 244, 539.5, 245, 539.5, 246, 539.5, 247, 539.5, 248,
        539.5, 249, 539.5, 250, 539.5, 252, 539.5, 252, 539.5, 253, 538.5, 254, 538.5, 256, 538.5, 257, 538.5, 258,
        538.5, 259, 538.5, 259, 538.5, 260, 538.5, 261, 538.5, 262, 538.5, 262, 538.5, 263, 538.5, 263, 538.5, 264,
        538.5, 265, 538.5, 266, 538.5, 267, 538.5, 267, 537.5, 269, 537.5, 269, 537.5, 270, 537.5, 271, 537.5, 271,
        537.5, 272, 537.5, 272, 537.5, 273, 537.5, 274, 537.5, 275, 537.5, 275, 537.5, 276, 537.5, 277, 537.5, 278,
        537.5, 279, 537.5, 280, 537.5, 280, 537.5, 282, 537.5, 283, 537.5, 284, 537.5, 285, 537.5, 286, 537.5, 287,
        537.5, 288, 537.5, 289, 537.5, 290, 537.5, 291, 537.5, 293, 537.5, 294, 537.5, 295, 537.5, 296, 537.5, 297,
        537.5, 297, 537.5, 298, 537.5, 299, 537.5, 300, 537.5, 302, 537.5, 302, 537.5, 303, 537.5, 304, 537.5, 305,
        537.5, 306, 537.5, 307, 537.5, 308, 537.5, 309, 537.5, 310, 537.5, 311, 537.5, 312, 537.5, 313, 537.5, 314,
        537.5, 316, 537.5, 318, 537.5, 319, 537.5, 321, 537.5, 323, 537.5, 325, 537.5, 325, 537.5, 326, 537.5, 327,
        537.5, 328, 537.5, 329, 537.5, 331, 537.5, 333, 537.5, 334, 537.5, 336, 537.5, 338, 537.5, 340, 537.5, 342,
        537.5, 343, 537.5, 345, 537.5, 346, 537.5, 348, 537.5, 350, 537.5, 351, 537.5, 352, 537.5, 353, 537.5, 355,
        537.5, 356, 537.5, 358, 537.5, 359, 537.5, 361, 537.5, 363, 537.5, 364, 537.5, 366, 537.5, 368, 537.5, 369,
        537.5, 371, 537.5, 372, 536.5, 374, 536.5, 375, 536.5, 376, 536.5, 377, 536.5, 378, 536.5, 380, 536.5, 382,
        536.5, 384, 536.5, 385, 536.5, 387, 536.5, 389, 536.5, 390, 536.5, 390, 536.5, 391, 536.5, 392, 536.5, 393,
        536.5, 394, 536.5, 396, 536.5, 397, 536.5, 398, 536.5, 400, 536.5, 402, 536.5, 403, 536.5, 404, 536.5, 405,
        536.5, 407, 536.5, 408, 536.5, 409, 536.5, 410, 535.5, 411, 535.5, 412, 535.5, 414, 535.5, 415, 535.5, 416,
        535.5, 418, 535.5, 419, 536.5, 420, 536.5, 422, 536.5, 423, 536.5, 425, 536.5, 426, 535.5, 427, 535.5, 429,
        535.5, 430, 535.5, 432, 535.5, 434, 535.5, 435, 535.5, 436, 535.5, 437, 535.5, 439, 535.5, 440, 535.5, 442,
        535.5, 444, 534.5, 445, 534.5, 447, 534.5, 449, 534.5, 451, 534.5, 453, 534.5, 455, 534.5, 460, 534.5, 461,
        534.5, 462, 534.5, 463, 534.5, 464, 534.5, 466, 534.5, 468, 534.5, 469, 534.5, 471, 533.5, 473, 533.5, 475,
        533.5, 476, 533.5, 477, 533.5, 479, 533.5, 480, 533.5, 481, 533.5, 482, 533.5, 484, 533.5, 485, 533.5, 486,
        533.5, 488, 533.5, 489, 533.5, 490, 533.5, 492, 533.5, 493, 533.5, 495, 533.5, 497, 533.5, 499, 532.5, 500,
        532.5, 501, 532.5, 502, 532.5, 504, 532.5, 504, 532.5, 505, 532.5, 506, 532.5, 507, 532.5, 508, 532.5, 510,
        532.5, 511, 532.5, 512, 532.5, 513, 532.5, 515, 532.5, 516, 532.5, 517, 532.5, 518, 531.5, 519, 531.5, 519,
        531.5, 520, 531.5, 521, 531.5, 522, 531.5, 522, 531.5, 523, 531.5, 524, 531.5, 525, 531.5, 526, 531.5, 527,
        531.5, 528, 531.5, 528, 531.5, 529, 531.5, 530, 531.5, 531, 531.5, 532, 531.5, 532, 531.5, 533, 531.5, 534,
        531.5, 535, 531.5, 536, 531.5, 537, 531.5, 538, 531.5, 539, 531.5, 540, 531.5, 541, 531.5, 542, 531.5, 543,
        531.5, 544, 531.5, 545, 531.5, 546, 530.5, 547, 530.5, 549, 530.5, 550, 530.5, 551, 530.5, 552, 530.5, 553,
        530.5, 555, 530.5, 556, 530.5, 556, 530.5, 557, 530.5, 559, 530.5, 560, 530.5, 561, 530.5, 563, 530.5, 564,
        530.5, 565, 530.5, 566, 530.5, 568, 530.5, 569, 530.5, 571, 530.5, 572, 530.5, 574, 530.5, 575, 530.5, 576,
        530.5, 577, 530.5, 579, 530.5, 580, 530.5, 581, 530.5, 582, 530.5, 584, 530.5, 585, 530.5, 587, 530.5, 588,
        530.5, 589, 530.5, 590, 530.5, 592, 530.5, 593, 530.5, 595, 530.5, 596, 530.5, 597, 530.5, 598, 530.5, 599,
        530.5, 599, 530.5, 600, 530.5, 601, 530.5, 602, 530.5, 603, 530.5, 605, 530.5, 606, 530.5, 607, 530.5, 608,
        529.5, 610, 529.5, 611, 529.5, 612, 529.5, 612, 529.5, 613, 529.5, 614, 529.5, 615, 529.5, 616, 529.5, 617,
        529.5, 618, 529.5, 620, 529.5, 621, 529.5, 623, 529.5, 624, 529.5, 626, 529.5, 627, 529.5, 629, 529.5, 631,
        529.5, 632, 529.5, 634, 529.5, 635, 529.5, 637, 529.5, 638, 529.5, 640, 529.5, 642, 529.5, 644, 529.5, 646,
        529.5, 648, 529.5, 650, 529.5, 652, 528.5, 653, 528.5, 655, 528.5, 656, 528.5, 658, 528.5, 659, 528.5, 660,
        528.5, 661, 528.5, 662, 528.5, 664, 528.5, 665, 528.5, 666, 528.5, 668, 528.5, 669, 528.5, 670, 528.5, 672,
        528.5, 673, 528.5, 674, 528.5, 675, 528.5, 676, 528.5, 677, 528.5, 678, 528.5, 680, 528.5, 681, 528.5, 682,
        528.5, 683, 528.5, 684, 528.5, 685, 528.5, 687, 528.5, 688, 528.5, 689, 528.5, 690, 528.5, 691, 528.5, 691,
        528.5, 692, 528.5, 693, 528.5, 694, 528.5, 696, 528.5, 697, 528.5, 698, 528.5, 699, 528.5, 701, 528.5, 703,
        528.5, 704, 528.5, 706, 528.5, 708, 528.5, 709, 528.5, 711, 528.5, 713, 528.5, 714, 528.5, 716, 528.5, 717,
        528.5, 719, 528.5, 721, 528.5, 723, 528.5, 725, 528.5, 726, 528.5, 728, 528.5, 730, 528.5, 732, 528.5, 733,
        528.5, 735, 528.5, 737, 528.5, 739, 528.5, 742, 528.5, 744, 528.5, 746, 528.5, 749, 527.5, 752, 527.5, 754,
        527.5, 757, 527.5, 759, 527.5, 762, 527.5, 764, 527.5, 766, 527.5, 768, 527.5, 770, 527.5, 772, 527.5, 774,
        527.5, 776, 527.5, 778, 527.5, 780, 527.5, 782, 527.5, 785, 527.5, 787, 527.5, 789, 527.5, 791, 527.5, 794,
        528.5, 797, 528.5, 799, 528.5, 802, 528.5, 804, 528.5, 806, 528.5, 808, 528.5, 810, 528.5, 812, 528.5, 814,
        528.5, 817, 528.5, 819, 528.5, 820, 528.5, 827, 527.5, 830, 527.5, 833, 527.5, 835, 527.5, 837, 527.5, 840,
        527.5, 843, 527.5, 845, 527.5, 847, 527.5, 849, 527.5, 851, 527.5, 853, 527.5, 856, 527.5, 858, 527.5, 860,
        527.5, 861, 527.5, 863, 527.5, 864, 527.5, 866, 527.5, 867, 527.5, 869, 527.5, 870, 527.5, 871, 527.5, 873,
        527.5, 874, 527.5, 876, 527.5, 877, 527.5, 878, 527.5, 879, 527.5, 880, 527.5, 881, 527.5, 882, 527.5, 883,
        527.5, 884, 527.5, 886, 527.5, 887, 527.5, 889, 527.5, 889, 527.5, 890, 527.5, 892, 527.5, 894, 527.5, 895,
        527.5, 897, 527.5, 899, 527.5, 901, 527.5, 903, 527.5, 905, 526.5, 907, 526.5, 909, 526.5, 911, 526.5, 913,
        526.5, 916, 526.5, 918, 526.5, 921, 526.5, 924, 526.5, 927, 526.5, 929, 526.5, 932, 526.5, 934, 526.5, 936,
        526.5, 938, 525.5, 940, 525.5, 941, 525.5, 943, 525.5, 944, 525.5, 946, 525.5, 948, 525.5, 949, 525.5, 950,
        525.5, 952, 525.5, 953, 524.5, 954, 524.5, 955, 524.5, 955, 524.5, 956, 524.5, 956, 524.5, 956, 524.5, 957,
        524.5, 957, 524.5, 957, 524.5, 958, 524.5, 958, 524.5, 958, 524.5, 959, 524.5, 959, 524.5, 959, 524.5, 959,
        524.5, 960, 524.5, 960, 524.5, 961, 523.5, 961, 523.5, 962, 523.5, 963, 523.5, 964, 523.5, 965, 523.5, 966,
        523.5, 966, 523.5, 967, 522.5, 968, 522.5, 968, 522.5, 969, 522.5, 970, 521.5, 970, 521.5, 972, 521.5, 973,
        520.5, 974, 520.5, 975, 519.5, 977, 519.5, 979, 518.5, 980, 518.5, 982, 517.5, 984, 517.5, 986, 516.5, 987,
        516.5, 989, 515.5, 990, 515.5, 991, 515.5, 991, 515.5, 992, 514.5, 993, 514.5, 994, 514.5, 996, 514.5, 996,
        514.5, 997, 514.5, 997, 514.5, 997, 514.5, 997, 514.5, 997, 514.5, 997, 514.5, 998, 514.5, 998, 514.5, 998,
        514.5, 998, 513.5, 999, 513.5, 1000, 513.5, 1001, 513.5, 1002, 513.5, 1003, 513.5, 1003, 513.5, 1004, 513.5,
        1004, 513.5, 1004, 513.5, 1005, 513.5, 1005, 513.5, 1005, 513.5, 1006, 513.5, 1006, 513.5, 1007, 513.5, 1007,
        513.5, 1007, 513.5, 1007, 513.5, 1008, 512.5, 1008, 512.5, 1009, 512.5, 1009, 512.5, 1010, 512.5, 1011, 512.5,
        1012, 512.5, 1014, 512.5, 1015, 512.5, 1017, 512.5, 1018, 512.5, 1020, 512.5, 1021, 512.5, 1021, 512.5
      ],
      stroke: '#feaa01'
    },
    {
      points: [
        305, 526.5, 305, 526.5, 305, 526.5, 305, 526.5, 305, 526.5, 305, 526.5, 304, 526.5, 304, 526.5, 304, 526.5, 304,
        526.5, 305, 526.5, 306, 526.5, 306, 526.5, 307, 526.5, 308, 526.5, 309, 526.5, 309, 526.5, 310, 527.5, 311,
        527.5, 312, 527.5, 312, 527.5, 313, 527.5, 314, 528.5, 314, 528.5, 315, 528.5, 316, 528.5, 317, 528.5, 317,
        529.5, 318, 529.5, 319, 529.5, 319, 529.5, 320, 530.5, 321, 530.5, 321, 530.5, 322, 530.5, 322, 531.5, 323,
        531.5, 323, 531.5, 324, 531.5, 325, 532.5, 325, 532.5, 326, 532.5, 327, 532.5, 328, 533.5, 329, 533.5, 329,
        533.5, 330, 533.5, 330, 533.5, 331, 533.5, 331, 534.5, 331, 534.5, 332, 534.5, 332, 534.5, 333, 534.5, 333,
        535.5, 334, 535.5, 334, 535.5, 334, 535.5, 335, 535.5, 335, 535.5, 335, 535.5, 336, 535.5, 336, 535.5, 336,
        535.5, 337, 536.5, 337, 536.5, 338, 536.5, 338, 536.5, 338, 536.5, 338, 536.5, 338, 536.5, 339, 536.5, 339,
        536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339,
        536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339, 536.5, 339,
        536.5, 338, 536.5, 338, 536.5, 338, 537.5, 337, 537.5, 337, 537.5, 336, 537.5, 335, 538.5, 335, 538.5, 335,
        538.5, 334, 538.5, 333, 539.5, 333, 539.5, 332, 539.5, 332, 539.5, 331, 539.5, 331, 539.5, 330, 540.5, 329,
        540.5, 329, 540.5, 328, 540.5, 327, 540.5, 327, 541.5, 326, 541.5, 326, 541.5, 325, 541.5, 325, 541.5, 324,
        541.5, 323, 542.5, 323, 542.5, 322, 542.5, 322, 542.5, 321, 542.5, 321, 542.5, 320, 543.5, 320, 543.5, 320,
        543.5, 319, 543.5, 319, 543.5, 318, 543.5, 318, 543.5, 317, 543.5, 317, 544.5, 316, 544.5, 316, 544.5, 316,
        544.5, 315, 544.5, 315, 544.5, 314, 545.5, 314, 545.5, 313, 545.5, 313, 545.5, 313, 545.5, 312, 545.5, 312,
        545.5, 312, 546.5, 311, 546.5, 311, 546.5, 311, 546.5, 310, 546.5, 310, 546.5, 309, 547.5, 309, 547.5, 309,
        547.5, 308, 547.5, 308, 547.5, 307, 547.5, 307, 547.5, 307, 548.5, 307, 548.5, 306, 548.5, 306, 548.5, 306,
        548.5, 306, 548.5, 305, 549.5, 305, 549.5, 305, 549.5, 305, 549.5, 305, 549.5, 305, 549.5, 305, 549.5, 305,
        549.5, 305, 549.5, 305, 549.5
      ],
      stroke: '#feaa01'
    },
    {
      points: [
        534, 518.5, 534, 518.5, 534, 518.5, 534, 518.5, 534, 518.5, 534, 519.5, 534, 519.5, 534, 519.5, 534, 519.5, 535,
        519.5, 535, 519.5, 535, 519.5, 535, 519.5, 535, 520.5, 535, 520.5, 535, 520.5, 535, 520.5, 536, 520.5, 536,
        521.5, 536, 521.5, 537, 521.5, 537, 521.5, 538, 522.5, 538, 522.5, 539, 522.5, 539, 523.5, 539, 523.5, 540,
        523.5, 540, 524.5, 541, 524.5, 541, 524.5, 541, 524.5, 542, 525.5, 542, 525.5, 542, 525.5, 542, 525.5, 543,
        525.5, 543, 525.5, 543, 525.5, 543, 525.5, 543, 526.5, 543, 526.5, 543, 526.5, 543, 526.5, 544, 526.5, 544,
        526.5, 544, 526.5, 544, 526.5, 544, 526.5, 545, 526.5, 545, 526.5, 545, 527.5, 545, 527.5, 546, 527.5, 546,
        527.5, 546, 527.5, 546, 527.5, 546, 527.5, 546, 527.5, 546, 527.5, 547, 527.5, 547, 527.5, 547, 527.5, 548,
        528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548,
        528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548, 528.5, 548,
        528.5, 549, 528.5, 549, 528.5, 549, 528.5, 549, 528.5, 549, 528.5, 550, 528.5, 550, 529.5, 550, 529.5, 550,
        529.5, 550, 529.5, 551, 529.5, 551, 529.5, 551, 529.5, 551, 529.5, 551, 529.5, 551, 529.5, 551, 529.5, 551,
        530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552,
        530.5, 552, 530.5, 552, 530.5, 552, 530.5, 552, 530.5, 551, 530.5, 551, 530.5, 551, 531.5, 551, 531.5, 550,
        531.5, 550, 531.5, 550, 531.5, 549, 532.5, 549, 532.5, 548, 532.5, 548, 533.5, 547, 533.5, 546, 534.5, 545,
        534.5, 544, 535.5, 543, 535.5, 543, 535.5, 542, 536.5, 542, 536.5, 541, 537.5, 540, 537.5, 539, 538.5, 538,
        538.5, 537, 539.5, 536, 539.5, 535, 540.5, 534, 540.5, 533, 541.5, 533, 541.5, 532, 542.5, 531, 542.5, 530,
        543.5, 529, 544.5, 528, 544.5, 527, 545.5, 526, 545.5, 525, 546.5, 524, 546.5, 523, 547.5, 522, 548.5, 522,
        548.5, 521, 548.5, 520, 549.5, 520, 549.5, 519, 549.5, 519, 550.5, 518, 550.5, 518, 550.5, 518, 550.5, 517,
        550.5, 517, 550.5, 517, 551.5, 517, 551.5, 517, 551.5, 517, 551.5, 517, 550.5, 517, 550.5, 517, 550.5, 517,
        550.5, 517, 550.5, 518, 550.5, 518, 550.5, 518, 550.5
      ],
      stroke: '#feaa01'
    },
    {
      points: [
        752, 516.5, 753, 516.5, 753, 517.5, 754, 517.5, 754, 517.5, 755, 518.5, 756, 518.5, 757, 519.5, 758, 519.5, 759,
        520.5, 760, 520.5, 761, 520.5, 762, 521.5, 762, 521.5, 763, 521.5, 763, 521.5, 764, 522.5, 764, 522.5, 765,
        522.5, 765, 522.5, 766, 522.5, 766, 523.5, 767, 523.5, 768, 523.5, 768, 523.5, 769, 524.5, 769, 524.5, 769,
        524.5, 770, 525.5, 771, 525.5, 771, 525.5, 771, 525.5, 772, 525.5, 772, 525.5, 772, 526.5, 773, 526.5, 774,
        526.5, 775, 527.5, 776, 527.5, 776, 527.5, 777, 528.5, 777, 528.5, 777, 528.5, 777, 528.5, 778, 528.5, 778,
        528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778,
        528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778, 528.5, 778,
        529.5, 777, 529.5, 777, 529.5, 777, 529.5, 776, 529.5, 775, 530.5, 774, 530.5, 774, 530.5, 773, 531.5, 772,
        531.5, 771, 532.5, 770, 532.5, 768, 533.5, 767, 533.5, 767, 533.5, 765, 534.5, 764, 534.5, 763, 535.5, 762,
        535.5, 760, 536.5, 759, 536.5, 758, 537.5, 756, 538.5, 754, 539.5, 753, 540.5, 751, 540.5, 749, 541.5, 748,
        542.5, 747, 542.5, 746, 543.5, 745, 543.5, 744, 543.5, 743, 544.5, 743, 544.5, 742, 544.5, 742, 544.5, 742,
        544.5, 741, 545.5, 741, 545.5, 741, 545.5, 741, 545.5, 741, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740,
        545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740, 545.5, 740,
        545.5, 740, 545.5, 740, 545.5, 740, 545.5, 741, 545.5, 741, 545.5, 742, 545.5, 742, 544.5
      ],
      stroke: '#feaa01'
    },
    {
      points: [
        1017, 511.5, 1014, 511.5, 1013, 510.5, 1012, 510.5, 1010, 510.5, 1007, 510.5, 1004, 510.5, 1002, 510.5, 1000,
        510.5, 998, 509.5, 996, 509.5, 994, 508.5, 991, 508.5, 988, 507.5, 987, 507.5, 985, 506.5, 982, 506.5, 980,
        505.5, 979, 505.5, 978, 505.5, 977, 505.5, 976, 505.5, 976, 505.5, 975, 504.5, 974, 504.5, 974, 504.5, 973,
        504.5, 972, 504.5, 972, 504.5, 972, 504.5, 972, 504.5, 972, 504.5, 971, 504.5, 971, 504.5, 971, 504.5, 971,
        504.5, 972, 504.5, 972, 504.5, 973, 504.5, 974, 504.5, 975, 504.5
      ],
      stroke: '#feaa01'
    },
    {
      points: [
        1017, 514.5, 1016, 514.5, 1016, 514.5, 1016, 514.5, 1015, 515.5, 1015, 515.5, 1014, 515.5, 1013, 516.5, 1012,
        516.5, 1011, 517.5, 1010, 517.5, 1009, 518.5, 1007, 519.5, 1006, 520.5, 1005, 520.5, 1004, 521.5, 1003, 521.5,
        1002, 522.5, 1000, 523.5, 999, 523.5, 998, 524.5, 997, 524.5, 995, 525.5, 994, 526.5, 993, 526.5, 993, 527.5,
        992, 527.5, 992, 527.5, 991, 527.5, 991, 528.5, 990, 528.5, 990, 528.5, 990, 528.5, 990, 528.5, 989, 528.5, 989,
        529.5, 989, 529.5, 989, 529.5, 989, 529.5, 988, 529.5, 988, 529.5, 988, 529.5, 988, 529.5, 988, 530.5, 988,
        530.5, 988, 530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987,
        530.5, 987, 530.5, 987, 530.5, 987, 530.5, 987, 531.5, 987, 531.5, 988, 531.5
      ],
      stroke: '#d8352a'
    }
  ]

  // Calculate the scaling factors
  const scaleX = width / originalSize.width
  const scaleY = height / originalSize.height

  const handlePointerDown = (e: KonvaEventObject<MouseEvent | TouchEvent>) => {
    setIsDrawing(true)
    const stage = e.target.getStage()

    if (!stage) return

    const point = stage.getPointerPosition()

    // Adjust point to original coordinates
    const adjustedPoint = {
      x: point!.x / scaleX,
      y: point!.y / scaleY
    }

    // Start a new line with stroke 'red'
    setLines([...lines, { points: [adjustedPoint.x, adjustedPoint.y], stroke: '#d8352a' }])
  }

  const handlePointerMove = (e: KonvaEventObject<MouseEvent | TouchEvent>) => {
    e.evt.preventDefault()
    if (!isDrawing) return

    const stage = e.target.getStage()

    if (!stage) return

    const point = stage.getPointerPosition()

    // Adjust point to original coordinates
    const adjustedPoint = {
      x: point!.x / scaleX,
      y: point!.y / scaleY
    }

    // Update the last line's points
    setLines((prevLines) => {
      const updatedLines = prevLines.slice()
      const lastLine = { ...updatedLines[updatedLines.length - 1] }
      lastLine.points = lastLine.points.concat([adjustedPoint.x, adjustedPoint.y])
      updatedLines[updatedLines.length - 1] = lastLine
      return updatedLines
    })
  }

  const handlePointerUp = () => {
    if (!isDrawing) return
    setIsDrawing(false)

    setLines((prevLines) => {
      const updatedLines = prevLines.slice()
      const lastLine = { ...updatedLines[updatedLines.length - 1] }
      if (lastLine) {
        lastLine.stroke = '#feaa01'
        updatedLines[updatedLines.length - 1] = lastLine
      }
      return updatedLines
    })
  }

  const handleClearLines = () => {
    setLines([])
  }

  return (
    <div className='font-base'>
      <div
        ref={parentRef}
        className='canvas-container relative mx-auto aspect-[4/3] w-canvas-width max-w-full overflow-hidden rounded-md bg-[url(https://images.theconversation.com/files/634721/original/file-20241127-15-cjheir.jpg?ixlib=rb-4.1.0&q=45&auto=format&w=800)] bg-cover bg-no-repeat shadow-lg'
      >
        <Stage
          width={width}
          height={height}
          scaleX={scaleX}
          scaleY={scaleY}
          onMouseDown={handlePointerDown}
          onTouchStart={handlePointerDown}
          onMouseMove={handlePointerMove}
          onTouchMove={handlePointerMove}
          onMouseUp={handlePointerUp}
          onTouchEnd={handlePointerUp}
          onMouseLeave={handlePointerUp}
          onTouchCancel={handlePointerUp}
        >
          <Layer>
            {lines.map((line, i) => (
              <Line
                key={i}
                points={line.points}
                stroke={line.stroke}
                strokeWidth={4}
                tension={0.4}
                lineCap='round'
                lineJoin='round'
              />
            ))}
            {revealAnswer.quiz3 &&
              answerLines.map((line, i) => (
                <Line
                  key={i}
                  points={line.points}
                  stroke={'#40bf95'}
                  strokeWidth={4}
                  tension={0.4}
                  lineCap='round'
                  lineJoin='round'
                />
              ))}
          </Layer>
        </Stage>

        <div className='absolute left-2 top-2 text-sm md:text-lg'>
          <button
            onClick={handleClearLines}
            className='cursor-pointer bg-neutral-500/20 p-2 text-white backdrop-blur-sm transition-all duration-150 ease-in-out hover:text-neutral-100 hover:shadow-lg active:scale-95'
          >
            Clear
          </button>
        </div>
      </div>
    </div>
  )
}
